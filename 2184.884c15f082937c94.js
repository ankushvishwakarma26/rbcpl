"use strict";(self.webpackChunkintranet=self.webpackChunkintranet||[]).push([[2184],{2184:(f,n,t)=>{t.r(n),t.d(n,{ChatComponent:()=>p});var m=t(3620),h=t(3997),c=t(6814),i=t(9212),g=t(9963),l=t(2425),u=t(5633),v=t(266);const d=["popup"];let p=(()=>{class r{constructor(e,s,a,o){this.service=e,this.toast=s,this.userservice=a,this.route=o,this.messageArray=[],this.storageArray=[],this.showScreen=!1,this.userList=[{id:1,name:"The Swag Coder",phone:"9876598765",image:"assets/user/user-1.png",roomId:{2:"room-1",3:"room-2",4:"room-3"}},{id:2,name:"Wade Warren",phone:"9876543210",image:"assets/user/user-2.png",roomId:{1:"room-1",3:"room-4",4:"room-5"}},{id:3,name:"Albert Flores",phone:"9988776655",image:"assets/user/user-3.png",roomId:{1:"room-2",2:"room-4",4:"room-6"}},{id:4,name:"Dianne Russell",phone:"9876556789",image:"assets/user/user-4.png",roomId:{1:"room-3",2:"room-5",3:"room-6"}}],this.searchvalue="",this.receiveremail="",this.receivername="",this.designation="",this.message="",this.textenable=!1}ngAfterViewInit(){var e=this.userservice.GetTokenExpiry();console.log(e),null!=e?this.userservice.isTokenExpired(e)&&(this.toast.error("Login Expired!!! Please Re-login again"),setTimeout(()=>{this.route.navigate(["/login"])},1e3)):this.route.navigate(["/login"])}ngOnInit(){this.currentUser=this.userservice.GetFullName(),this.LoadUser()}ngOnDestroy(){this.service.messagelist=[]}selectUserHandler(){this.messageArray=[],this.join(this.userservice.GetFullName(),this.userservice.GetUserName())}join(e,s){this.service.joinRoom({user:e,room:s})}sendMessage(){this.service.sendMessage({user:this.userservice.GetFullName(),room:this.userservice.GetUserName(),message:this.messageText}),this.messageText=""}LoadUser(){this.service.GetUser(this.searchvalue,this.userservice.GetUserName()).pipe((0,m.b)(500),(0,h.x)()).subscribe(e=>{"success"==e.status?this.service.userlist=e.data:this.toast.warning(e.message,"Warning")})}ReadMessage(e){this.textenable=!0,this.receiveremail=e.Email,this.receivername=e.FirstName+" "+e.LastName,this.designation=e.Designation,this.service.messagelist=[],this.GetAllMessage(),this.interval=setInterval(()=>{this.GetAllMessage()},6e4),e.count>0&&this.service.ReadMessage(this.userservice.GetUserName()).subscribe(s=>{(s.status="success")&&this.LoadUser()})}GetAllMessage(){""!=this.receiveremail&&this.service.GetMessage(this.receiveremail,this.userservice.GetUserName()).subscribe(e=>{"success"==e.status&&(this.service.messagelist=e.data)})}gettime(){let e=new Date,a=e.getTime()+Math.abs(6e4*e.getTimezoneOffset());return new Date(a).toISOString()}SendMessage(){this.service.messagedata.fromname=this.userservice.GetFullName(),this.service.messagedata.fromuser=this.userservice.GetUserName(),this.service.messagedata.toname=this.receivername,this.service.messagedata.touser=this.receiveremail,this.service.messagedata.message=this.message,this.service.messagedata.isread=!1,this.service.messagedata.status="Sent",this.service.messagedata.datetime=this.gettime(),this.service.SendMessage().subscribe(e=>{"success"==e.status&&(this.GetAllMessage(),this.message="")})}static#e=this.\u0275fac=function(s){return new(s||r)(i.Y36(g.a),i.Y36(l._W),i.Y36(u.K),i.Y36(v.F0))};static#s=this.\u0275cmp=i.Xpm({type:r,selectors:[["app-chat"]],viewQuery:function(s,a){if(1&s&&i.Gf(d,5),2&s){let o;i.iGM(o=i.CRH())&&(a.popup=o.first)}},standalone:!0,features:[i.jDz],decls:0,vars:0,template:function(s,a){},dependencies:[c.ez],styles:[".gradient-custom[_ngcontent-%COMP%]{background:#fccb90;background:linear-gradient(to bottom right,rgba(252,203,144,1),rgba(213,126,235,1))}.mask-custom[_ngcontent-%COMP%]{background:rgba(24,24,16,.2);border-radius:2em;-webkit-backdrop-filter:blur(15px);backdrop-filter:blur(15px);border:2px solid rgba(255,255,255,.05);background-clip:padding-box;box-shadow:10px 10px 10px #2e364408}"]})}return r})()}}]);